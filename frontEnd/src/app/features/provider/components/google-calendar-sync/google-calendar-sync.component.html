<div class="calendar-container">
  <!-- Calendar Header -->
  <div class="calendar-header">
    <div class="header-left">
      <h2 class="calendar-title">üìÖ Booking Calendar</h2>
      <p class="calendar-subtitle">Manage your bookings in calendar view</p>
    </div>
    <div class="header-right">
      <button class="today-btn" (click)="goToToday()">Today</button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner">‚è≥</div>
    <p>Loading your bookings...</p>
  </div>

  <!-- Calendar Navigation -->
  <div *ngIf="!loading" class="calendar-navigation">
    <button class="nav-btn" (click)="previousMonth()">
      <span>‚Äπ</span>
    </button>
    <h3 class="current-month">{{ monthNames[currentMonth] }} {{ currentYear }}</h3>
    <button class="nav-btn" (click)="nextMonth()">
      <span>‚Ä∫</span>
    </button>
  </div>

  <!-- Calendar Grid -->
  <div *ngIf="!loading" class="calendar-grid">
    <!-- Week Day Headers -->
    <div class="calendar-weekdays">
      <div class="weekday" *ngFor="let day of weekDays">{{ day }}</div>
    </div>

    <!-- Calendar Days -->
    <div class="calendar-days">
      <div 
        *ngFor="let day of calendarDays" 
        class="calendar-day"
        [class.other-month]="!day.isCurrentMonth"
        [class.today]="day.isToday"
        [class.has-bookings]="day.bookingCount > 0"
        (mouseenter)="onDayHover(day)"
        (mouseleave)="onDayLeave()"
        (click)="day.isCurrentMonth && onDayClick(day)">
        
        <div class="day-number">{{ day.day }}</div>
        
        <!-- Booking Indicators -->
        <div class="booking-indicators" *ngIf="day.bookingCount > 0">
          <div class="booking-dots">
            <span 
              *ngFor="let booking of day.bookings.slice(0, 3)" 
              class="booking-dot"
              [class.confirmed]="booking.status === 'confirmed'"
              [class.pending]="booking.status === 'pending'"
              [class.cancelled]="booking.status === 'cancelled'">
            </span>
          </div>
          <div class="booking-count" *ngIf="day.bookingCount > 3">
            +{{ day.bookingCount - 3 }}
          </div>
        </div>

        <!-- Hover Tooltip -->
        <div class="hover-tooltip" *ngIf="hoveredDay === day && day.bookingCount > 0">
          <div class="tooltip-header">{{ day.bookingCount }} Booking(s)</div>
          <div class="tooltip-booking" *ngFor="let booking of day.bookings.slice(0, 3)">
            <span class="tooltip-time">{{ formatTime(booking.startTime) }}</span>
            <span class="tooltip-customer">{{ booking.customerName }}</span>
            <span class="tooltip-status" [class]="getStatusClass(booking.status)">{{ booking.status }}</span>
          </div>
          <div class="tooltip-more" *ngIf="day.bookingCount > 3">
            Click to see all {{ day.bookingCount }} bookings
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="error-banner">
    ‚ö†Ô∏è {{ errorMessage }}
  </div>
</div>

<!-- Booking Modal -->
<div class="modal-backdrop" *ngIf="showBookingModal" (click)="closeModal()">
  <div class="booking-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>üìÖ Bookings for {{ selectedDate ? formatDate(selectedDate) : '' }}</h3>
      <button class="close-btn" (click)="closeModal()">&times;</button>
    </div>

    <div class="modal-body">
      <!-- No Bookings -->
      <div *ngIf="selectedDayBookings.length === 0" class="no-bookings">
        <div class="no-bookings-icon">üì≠</div>
        <p>No bookings for this day</p>
      </div>

      <!-- Bookings List -->
      <div *ngIf="selectedDayBookings.length > 0" class="bookings-list">
        <div *ngFor="let booking of selectedDayBookings" class="booking-card">
          <!-- View Mode -->
          <div *ngIf="editingBooking?.id !== booking.id" class="booking-view">
            <div class="booking-header">
              <div class="booking-time">
                <span class="time-icon">üïê</span>
                {{ formatTime(booking.startTime) }} - {{ formatTime(booking.endTime) }}
              </div>
              <span class="status-badge" [class]="getStatusClass(booking.status)">
                {{ booking.status }}
              </span>
            </div>

            <div class="booking-details">
              <div class="detail-row">
                <span class="detail-label">üë§ Customer:</span>
                <span class="detail-value">{{ booking.customerName }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">üìß Email:</span>
                <span class="detail-value">{{ booking.customerEmail }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">üõ†Ô∏è Service:</span>
                <span class="detail-value">{{ booking.resource.name }}</span>
              </div>
              <div class="detail-row" *ngIf="booking.finalAmount">
                <span class="detail-label">üí∞ Amount:</span>
                <span class="detail-value">${{ booking.finalAmount }}</span>
              </div>
            </div>

            <div class="booking-actions">
              <button class="btn-edit" (click)="editBooking(booking)" *ngIf="booking.status !== 'cancelled'">
                ‚úèÔ∏è Edit Status
              </button>
              <button class="btn-cancel" (click)="cancelBooking(booking)" *ngIf="booking.status === 'pending' || booking.status === 'confirmed'">
                ‚ùå Cancel
              </button>
            </div>
          </div>

          <!-- Edit Mode -->
          <div *ngIf="editingBooking?.id === booking.id" class="booking-edit">
            <form [formGroup]="bookingForm" (ngSubmit)="saveBooking()">
              <div class="form-group">
                <label>Update Status:</label>
                <select formControlName="status" class="status-select">
                  <option value="pending">Pending</option>
                  <option value="confirmed">Confirmed</option>
                  <option value="completed">Completed</option>
                  <option value="cancelled">Cancelled</option>
                </select>
              </div>

              <div class="edit-actions">
                <button type="submit" class="btn-save" [disabled]="bookingForm.invalid">
                  ‚úÖ Save
                </button>
                <button type="button" class="btn-cancel-edit" (click)="cancelEdit()">
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-close" (click)="closeModal()">Close</button>
    </div>
  </div>
</div>